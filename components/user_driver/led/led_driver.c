/*
 * led_driver.c
 *
 *  Created on: Jan 9, 2021
 *      Author: ductu
 */
/***********************************************************************************************************************
* Pragma directive
***********************************************************************************************************************/

/***********************************************************************************************************************
* Includes <System Includes>
***********************************************************************************************************************/
#include "led_driver.h"
/***********************************************************************************************************************
* Macro definitions
***********************************************************************************************************************/

/***********************************************************************************************************************
* Typedef definitions
***********************************************************************************************************************/

/***********************************************************************************************************************
* Private global variables and functions
***********************************************************************************************************************/
static void led_on(void);
static void led_off(void);

/***********************************************************************************************************************
* Exported global variables and functions (to be accessed by other files)
***********************************************************************************************************************/

/***********************************************************************************************************************
* Imported global variables and functions (from other files)
***********************************************************************************************************************/

/***********************************************************************************************************************
* Function Name: 
* Description  :
* Arguments    : none
* Return Value : none
***********************************************************************************************************************/
/*
 * User task that fetches latest measurement results of sensor every 2
 * seconds. It starts the SHT3x in periodic mode with 1 measurements per
 * second (*sht3x_periodic_1mps*).
 */
uint8_t state;
uint32_t perivos_time_led = 0;
/***********************************************************************************************************************
* Function Name:
* Description  :
* Arguments    : none
* Return Value : none
***********************************************************************************************************************/
void led_driver_process(void)
{
    if (deive_data.wifi_status == 0)
    {
        // flarst blink
        switch (state)
        {
        case 0:
            perivos_time_led = usertimer_gettick();
            state = 1;
            led_on();
            break;
        case 1:
            if (usertimer_gettick() - perivos_time_led > 100)
            {
                led_off();
                state = 2;
                perivos_time_led = usertimer_gettick();
            }
            break;
        case 2:
            if (usertimer_gettick() - perivos_time_led > 100)
            {
                state = 0;
            }
            break;
        default:
            break;
        }
    }
    else if (deive_data.wifi_status == 1)
    {
        //slow bilnk
        switch (state)
        {
        case 0:
            perivos_time_led = usertimer_gettick();
            state = 1;
            led_on();
            break;
        case 1:
            if (usertimer_gettick() - perivos_time_led > 500)
            {
                led_off();
                state = 2;
                perivos_time_led = usertimer_gettick();
            }
            break;
        case 2:
            if (usertimer_gettick() - perivos_time_led > 500)
            {
                state = 0;
            }
            break;
        default:
            break;
        }
    }
}

/***********************************************************************************************************************
* Static Functions
***********************************************************************************************************************/
static void led_on(void)
{
    // APP_LOGI("led on call");
}

static void led_off(void)
{
    // APP_LOGI("led off call");
}
/***********************************************************************************************************************
* End of file
***********************************************************************************************************************/
